<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="statistics">

	<resultMap type="ExerciseContents" id="ExerciseContents">
		<result property="ExerciseContentsCode"
			column="Exercise_contents_code" />
		<result property="ExerciseSet" column="Exercise_set" />
		<result property="ExerciseReps" column="Exercise_reps" />
		<result property="ExerciseLb" column="Exercise_lb" />
	</resultMap>

	<resultMap type="ExerciseJournal" id="EJMap">
		<id property="ExerciseCode" column="exercise_code"></id>
		<result property="ExerciseName" column="Exercise_name" />
		<result property="start" column="Exercise_date" />
		<collection property="details" resultMap="ExerciseContents" />
	</resultMap>


	<select id="exerList" resultMap="EJMap">
		SELECT
		ei.Exercise_date,et.Exercise_name,ec.Exercise_contents_code,
		ec.Exercise_set,ec.Exercise_reps,ec.Exercise_lb
		FROM exercise_title et JOIN exercise_item ei 
		JOIN exercise_contents ec
		ON et.Exercise_title_code =
		ec.Exercise_title_code AND et.Exercise_code = ei.exercise_code
		WHERE ei.id = #{id}
	</select>
	
	<select id="getWeight" resultType="ExerciseJournal">
		SELECT
		ei.Exercise_date start,AVG(ei.userWeight) userWeight
		FROM exercise_item ei 
		WHERE ei.id = #{id}
		GROUP BY ei.Exercise_date
	</select>
	
	<select id="getAvgLb" resultType="ExerciseJournal">
		SELECT mytable.Exercise_date start,mytable.Exercise_name,ROUND(AVG(mytable.Exercise_lb),1) avgLb
		FROM (SELECT
		ei.Exercise_date,et.Exercise_name,ec.Exercise_contents_code,
		ec.Exercise_set,ec.Exercise_reps,ec.Exercise_lb
		FROM exercise_title et JOIN exercise_item ei 
		JOIN exercise_contents ec
		ON et.Exercise_title_code =
		ec.Exercise_title_code AND et.Exercise_code = ei.exercise_code
		WHERE ei.id = #{id}) mytable
		group by mytable.Exercise_date,mytable.Exercise_name
	
	</select>
</mapper>